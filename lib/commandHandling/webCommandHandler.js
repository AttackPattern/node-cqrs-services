"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _uuidValidate=_interopRequireDefault(require("uuid-validate")),_nodeCqrsLib=require("@facetdev/node-cqrs-lib");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function asyncGeneratorStep(e,r,n,t,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?r(s):Promise.resolve(s).then(t,a)}function _asyncToGenerator(u){return function(){var e=this,i=arguments;return new Promise(function(r,n){var t=u.apply(e,i);function a(e){asyncGeneratorStep(t,r,n,a,o,"next",e)}function o(e){asyncGeneratorStep(t,r,n,a,o,"throw",e)}a(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,n){return r&&_defineProperties(e.prototype,r),n&&_defineProperties(e,n),e}function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var WebCommandHandler=function(){function r(e){var a=this;_classCallCheck(this,r),_defineProperty(this,"handleCommand",function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var n,t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r.request.body).$position=r.$position,n.$identity=r.$identity,n.$timestamp=new Date,(t=r.params.aggregateId)&&!(0,_uuidValidate.default)(t))return r.status=404,r.body={error:"".concat(t," is not a valid UUID")},e.abrupt("return");e.next=9;break;case 9:return e.prev=9,e.next=12,a.domainCommandDeliverer.deliver({service:r.params.service,target:t,commandType:r.params.commandType,command:n});case 12:return r.body=e.sent,r.status=200,e.abrupt("return");case 17:e.prev=17,e.t0=e.catch(9),a.handleError(r,e.t0);case 20:case"end":return e.stop()}},e,null,[[9,17]])}));return function(e){return r.apply(this,arguments)}}()),this.domainCommandDeliverer=e}return _createClass(r,[{key:"handleError",value:function(e,r){r instanceof _nodeCqrsLib.ValidationError||"ValidationError"===(null==r?void 0:r.name)?(console.log("Validation failure"),e.status=400):r instanceof _nodeCqrsLib.AuthorizationError||"AuthorizationError"===(null==r?void 0:r.name)?(console.log("Authorization failure"),e.status=403):(r instanceof _nodeCqrsLib.CommandHandlerError?console.log("Error handling command"):console.log("Unexpected exception"),e.status=500),e.body={error:null==r?void 0:r.message},console.log(r)}}]),r}();exports.default=WebCommandHandler;
//# sourceMappingURL=../maps/commandHandling/webCommandHandler.js.map
