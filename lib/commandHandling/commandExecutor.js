"use strict";function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(r){_defineProperty(e,r,t[r])})}return e}function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,o=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}function asyncGeneratorStep(e,r,t,n,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void t(e)}s.done?r(i):Promise.resolve(i).then(n,o)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){function a(e){asyncGeneratorStep(s,n,o,a,c,"next",e)}function c(e){asyncGeneratorStep(s,n,o,a,c,"throw",e)}var s=e.apply(r,t);a(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _nodeCqrsLib=require("@facetdev/node-cqrs-lib"),CommandExecutor=function e(r){var t=this,n=r.name,o=r.handlers,a=r.repository;_classCallCheck(this,e),_defineProperty(this,"execute",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var n,o,a,c,s,i,u,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.aggregateId,o=r.commandType,a=r.command,c=t.handlers[o]&&t.handlers[o]()){e.next=4;break}throw new _nodeCqrsLib.CommandHandlerError({message:"Unknown command ".concat(o)});case 4:return e.prev=4,e.next=7,t.getAggregate(c,n);case 7:return s=e.sent,e.next=10,c.handle(a,s);case 10:return i=e.sent,u=i||{},p=u.events,f=_objectWithoutProperties(u,["events"]),e.next=14,t.repository.record(p);case 14:return e.abrupt("return",_objectSpread({id:s.id},f));case 17:throw e.prev=17,e.t0=e.catch(4),e.t0.handler=c,e.t0;case 21:case"end":return e.stop()}},e,this,[[4,17]])}));return function(r){return e.apply(this,arguments)}}()),_defineProperty(this,"getAggregate",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}return e.next=3,t.repository.create();case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,t.repository.get(n);case 6:if(e.t0=e.sent,e.t0){e.next=14;break}if(e.t1=r.isCreateHandler,!e.t1){e.next=13;break}return e.next=12,t.repository.create(n);case 12:e.t1=e.sent;case 13:e.t0=e.t1;case 14:if(o=e.t0){e.next=17;break}throw new _nodeCqrsLib.CommandHandlerError({message:"".concat(t.name," ").concat(n," not found"),handler:r,aggregate:o});case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()),this.name=n,this.handlers=o,this.repository=a};exports.default=CommandExecutor;
//# sourceMappingURL=../maps/commandHandling/commandExecutor.js.map
