"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_koaRouter=require("koa-router"),_koaRouter2=_interopRequireDefault(_koaRouter),_awsSdk=require("aws-sdk"),_awsSdk2=_interopRequireDefault(_awsSdk),_v=require("uuid/v4"),_v2=_interopRequireDefault(_v),UploadRouter=function(e){function r(e){var t=this;(0,_classCallCheck3.default)(this,r);var u=(0,_possibleConstructorReturn3.default)(this,(r.__proto__||(0,_getPrototypeOf2.default)(r)).call(this));return u.getSignedRequest=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){var o,a;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=(0,_v2.default)();try{a=u.s3.getSignedUrl("putObject",{Bucket:u.bucket,Key:o+".jpg",Expires:60,ContentType:"image/jpeg",ACL:"public-read"}),r.status=200,r.body={fileId:o,signedRequest:a,url:"https://"+u.bucket+".s3.amazonaws.com/"+o+".jpg"}}catch(e){r.status=500,console.log(e),r.body={error:"Failed to build upload url"}}case 2:case"end":return e.stop()}},e,t)}));return function(r){return e.apply(this,arguments)}}(),u.bucket=e.S3_Bucket,u.s3=new _awsSdk2.default.S3({accessKeyId:e.AccessKey,secretAccessKey:e.SecretAccessKey}),u.prefix("/upload").get("/signRequest",u.getSignedRequest),u}return(0,_inherits3.default)(r,e),r}(_koaRouter2.default);exports.default=UploadRouter,module.exports=exports.default;
//# sourceMappingURL=../maps/routing/uploadRouter.js.map
